---
title: "R Notebook"
output: html_notebook
---

```{r file set up}
#Import data
library(readxl)
setwd(r"{E:\OMSA\Semesters\01_Fall_23\MGMT 6203\Group Project\Code}")
df_temp <- read.csv("df_draft_associated_v1.csv",header=TRUE)
```

```{r}
#Sentiment distribution by team, all look very similar
library(ggplot2)
library(ggridges)

ggplot(df_temp, aes(x = sentiment, y = Team.Fan, fill = stat(x))) +
  geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01) +
  scale_fill_viridis_c(name = "Sentiment", option = "C") +
  labs(title = 'Sentiment Distribution by Team')

```

```{r kernel estimation}
ggplot(df_temp, aes(x = sentiment)) +
  geom_density(fill = "blue") +  # Adjust fill color as needed
  facet_wrap(~Team.Fan)  # Creates separate plots for each team

```


```{r distributions}
#Violin plots for teams. Most look similar but some (unsurprisingly PHI who has a notoriously tough fan base) have a more negative skew.
library(ggplot2)

summary_list <- list()
unique_teams <- unique(df_temp$Team.Fan)
overall_count <- nrow(df_temp)

for (team in unique_teams) {
  team_data <- df_temp[df_temp$Team.Fan == team, ]
  
  team_summary <- summary(team_data$sentiment)
  
  count <- length(team_data$sentiment)
  proportion <- count / overall_count
  
  # Create a violin plot for the current team
  p <- ggplot(team_data, aes(x = Team.Fan, y = sentiment, fill = Team.Fan)) +
    geom_violin() +
    scale_fill_manual(values = setNames(rainbow(length(unique_teams)), unique_teams)) +
    labs(title = paste("Sentiment Violin Plot for", team))
  
  # Print or save the plot (you can customize this part)
  print(p)
  
  # Store the summary statistics and count in the list
 summary_list[[team]] <- list(Summary = team_summary, Count = count, Proportion = proportion)
}


```

```{r summary statistics}
#Summary statistics for each team, including count of comments and overall proportion of comments

for (team in unique_teams) {
  cat("Summary Statistics for", team, " (Count:", summary_list[[team]]$Count, ", Proportion:", summary_list[[team]]$Proportion, "):\n")
  print(summary_list[[team]]$Summary)
  cat("\n")
}
```

```{r scatter}
#Correlation between proportion of comments and average sentiment
library(ggplot2)

overall_count <- nrow(df_temp)
unique_teams <- unique(df_temp$Team.Fan)

team_proportion <- numeric(length(unique_teams))
team_avg_sentiment <- numeric(length(unique_teams))

for (i in 1:length(unique_teams)) {
  team <- unique_teams[i]
  team_data <- df_temp[df_temp$Team.Fan == team, ]
  
  # Calculate proportion
  team_count <- nrow(team_data)
  team_proportion[i] <- team_count / overall_count
  
  # Calculate average sentiment
  team_avg_sentiment[i] <- mean(team_data$sentiment, na.rm = TRUE)
}

scatter_data <- data.frame(
  Team = unique_teams,
  Proportion = team_proportion,
  AvgSentiment = team_avg_sentiment
)

ggplot(scatter_data, aes(x = Proportion, y = AvgSentiment, label = Team)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  geom_text(hjust = -0.2, vjust = 0.3, size = 3) +
  labs(
    title = "Proportion vs. Average Sentiment",
    x = "Proportion of Count",
    y = "Average Sentiment"
  )

team_avg_sentiment
```

```{r distributions_player}
#The same as above but associated with the draft (by associated pick) team
library(ggplot2)

summary_list2 <- list()
unique_teams2 <- unique(df_temp$associated_team)
#overall_count <- nrow(df_temp)

for (team in unique_teams2) {
  team_data <- df_temp[df_temp$associated_team == team, ]
  team_summary <- summary(team_data$sentiment)
  count <- length(team_data$sentiment)
  proportion <- count / overall_count

  p <- ggplot(team_data, aes(x = associated_team, y = sentiment, fill = associated_team)) +
    geom_violin() +
    scale_fill_manual(values = setNames(rainbow(length(unique_teams)), unique_teams)) +
    labs(title = paste("Sentiment Violin Plot for", team))
  
  print(p)
  
 summary_list2[[team]] <- list(Summary = team_summary, Count = count, Proportion = proportion)
}


```

```{r summary statistics player}

for (team in unique_teams2) {
  cat("Summary Statistics for", team, " (Count:", summary_list2[[team]]$Count, ", Proportion:", summary_list2[[team]]$Proportion, "):\n")
  print(summary_list2[[team]]$Summary)
  cat("\n")
}
```
```{r scatter player}
library(ggplot2)

overall_count <- nrow(df_temp)
unique_teams <- unique(df_temp$associated_team)

team_proportion <- numeric(length(unique_teams))
team_avg_sentiment <- numeric(length(unique_teams))

for (i in 1:length(unique_teams)) {
  team <- unique_teams[i]
  team_data <- df_temp[df_temp$associated_team == team, ]
  
  # Calculate proportion
  team_count <- nrow(team_data)
  team_proportion[i] <- team_count / overall_count
  
  # Calculate average sentiment
  team_avg_sentiment[i] <- mean(team_data$sentiment, na.rm = TRUE)
}

scatter_data <- data.frame(
  Team = unique_teams,
  Proportion = team_proportion,
  AvgSentiment = team_avg_sentiment
)

ggplot(scatter_data, aes(x = Proportion, y = AvgSentiment, label = Team)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  geom_text(hjust = -0.2, vjust = 0.3, size = 3) +
  labs(
    title = "Proportion vs. Average Sentiment",
    x = "Proportion of Count",
    y = "Average Sentiment"
  )
```


```{r}

#Some notes on the data cleaning and analysis process:

#From initial cleaning, data is time stamped and not necessarily associated directly with a draft pick. Finding other ways, either by associating with the prior pick or with the commenter's team is important.

#There were (proportionally) large differences in both the average sentiments of different teams as well as the number of comments they received. It will be interesting to consider both as factors.

#More comments seems to correlate with a higher average team sentiment when comments are associated with a team by draft pick. When associating by the commenter's team affiliation this correlation reverses. This will be something to keep in mind when deciding how to bring in comment variables.


```

